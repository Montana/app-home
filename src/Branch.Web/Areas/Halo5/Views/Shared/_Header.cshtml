@using Branch.Helpers.Extentions
@model ViewModelBase
@{ 
	MatchHistory recentMatch = Model.MatchHistory?.Results?.FirstOrDefault();
	string recentMatchMapImage = string.Empty;
	MapVariant recentMatchMapVariant = null;
	GameVariant recentMatchGameVariant = null;
	if (recentMatch != null)
	{
		recentMatchMapVariant = await MetadataService.GetMapVariantMetadataAsync(recentMatch.MapVariant.ResourceId);
		recentMatchGameVariant = await MetadataService.GetGameVariantMetadataAsync(recentMatch.GameVariant.ResourceId);
		recentMatchMapImage = recentMatchMapVariant.MapImageUrl;
	}
}
<header class="halo5-service-record" style="background-image: url('@(recentMatchMapImage)')">
	<div class="mask">
		<div class="container">
			<div class="row">
				<div class="col-md-9">
					<div class="row name-flairs">
						<div class="spartan-rank hidden-sm hidden-xs col-md-1">
							@Model.ServiceRecord.SpartanRank
						</div>
						<div class="col-md-10">
							<h1>@Model.ServiceRecord.PlayerId.Gamertag</h1>
							<h2>BAE</h2>
						</div>
						<div class="spartan-rank responsive visible-sm visible-xs col-md-1">
							@Model.ServiceRecord.SpartanRank
						</div>
					</div>

					<div class="row rank-flairs">
						@{ 
							var currentRank = (await MetadataService.GetSpartanRanksMetadataAsync()).Results.FirstOrDefault(sr => sr.Id == Model.ServiceRecord.SpartanRank);
							var nextRank = (await MetadataService.GetSpartanRanksMetadataAsync()).Results.FirstOrDefault(sr => sr.Id == Model.ServiceRecord.SpartanRank + 1);
						}
						<div class="col-md-10">
							<img class="hidden-xs" height="25" alt="" src=""/>
							
							@{
								float percentage = 100;
								if (nextRank != null)
								{
									float a = (Model.ServiceRecord.Xp - currentRank.StartXp);
									float b = (nextRank.StartXp - currentRank.StartXp);
									percentage = ((a / b) * 100);
								}
							}
							<div class="progress">
								<div class="progress-bar" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: @percentage%">
									<span class="progress-bar-indicator">@percentage.ToString("0.00")% (<deliminate-number integer="@Model.ServiceRecord.Xp" /> Xp)</span>
									<span class="sr-only">@percentage.ToString("0.00")% (<deliminate-number integer="@Model.ServiceRecord.Xp" /> Xp)</span>
								</div>
							</div>
							<div class="xp">
								<div class="left lower-bound"><deliminate-number integer="@currentRank.StartXp" /> Xp</div>
								@if (nextRank != null)
								{
									<div class="right upper-bound"><deliminate-number integer="@nextRank.StartXp" /> Xp</div>
								}
								<div class="clearfix"></div>
							</div>
						</div>
					</div>

					@if (recentMatch != null)
					{
						<div class="row recent-match">
							Recent Matches:
							<br />
							<span id="recent-match-details" class="details">
								<strong class="@recentMatch.Players.First().Result.GetDescription().ToSlug()">@recentMatch.Players.First().Result.GetDescription()</strong> playing <strong>@recentMatchGameVariant.Name</strong> on <strong>@recentMatchMapVariant.Name</strong>,<br />
								with <strong>@recentMatch.Players.First().TotalKills</strong> Kills<br />
								<a class="alt date" href="#">
									&raquo; on @recentMatch.MatchCompletedDate.ISO8601Date.ToString("dddd, MMMM dd yyyy")
								</a>
							</span>
						</div>
					}
				</div>
				<div class="col-md-3">
					<div class="spartan-insignia hidden-sm hidden-xs" style="background-image: url('@Model.ServiceRecord.PlayerId.Emblem')"></div>
					<div class="spartan-image hidden-sm hidden-xs" style="background-image: url('@Model.ServiceRecord.PlayerId.SpartanModel')"></div>
				</div>
			</div>
		</div>
	</div>
</header>
